<!DOCTYPE html>
<html>
<head>
    <title>Direct API Test - Add Student</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #f5f5f5; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        input, select { width: 100%; padding: 8px; margin: 5px 0 15px; border: 1px solid #ddd; border-radius: 4px; }
        button { background: #059669; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #047857; }
        #result { margin-top: 20px; padding: 15px; border-radius: 4px; white-space: pre-wrap; font-family: monospace; }
        .success { background: #d1fae5; border: 1px solid #059669; }
        .error { background: #fee2e2; border: 1px solid #dc2626; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Direct API Test - Add Student</h1>
        <p>This bypasses React and tests the API directly</p>
        
        <form id="testForm">
            <label>Student ID:</label>
            <input type="text" id="studentId" value="TEST123" required>
            
            <label>First Name:</label>
            <input type="text" id="firstName" value="Test" required>
            
            <label>Last Name:</label>
            <input type="text" id="lastName" value="Student" required>
            
            <label>Email (optional):</label>
            <input type="email" id="email" value="test@example.com">
            
            <label>Phone (optional):</label>
            <input type="tel" id="phone" value="+27123456789">
            
            <label>Group ID:</label>
            <select id="groupId" required>
                <option value="">Loading groups...</option>
            </select>
            
            <button type="submit">üöÄ Test API Call</button>
        </form>
        
        <div id="result"></div>
    </div>

    <script>
        const resultDiv = document.getElementById('result');
        
        // Load groups on page load
        async function loadGroups() {
            try {
                const response = await fetch('/api/groups');
                const data = await response.json();
                const select = document.getElementById('groupId');
                select.innerHTML = '<option value="">Select a group...</option>';
                data.data.forEach(group => {
                    const option = document.createElement('option');
                    option.value = group.id;
                    option.textContent = `${group.name} - ${group.location || ''}`;
                    select.appendChild(option);
                });
                console.log('‚úÖ Groups loaded:', data.data.length);
            } catch (error) {
                console.error('‚ùå Error loading groups:', error);
                alert('Failed to load groups: ' + error.message);
            }
        }
        
        // Test form submission
        document.getElementById('testForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const data = {
                studentId: document.getElementById('studentId').value,
                firstName: document.getElementById('firstName').value,
                lastName: document.getElementById('lastName').value,
                email: document.getElementById('email').value || undefined,
                phone: document.getElementById('phone').value || undefined,
                groupId: document.getElementById('groupId').value,
                status: 'ACTIVE',
                progress: 0
            };
            
            console.log('üì§ Sending data:', data);
            resultDiv.textContent = '‚è≥ Sending request...\n\n' + JSON.stringify(data, null, 2);
            resultDiv.className = '';
            
            try {
                const response = await fetch('/api/students', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                console.log('üì• Response status:', response.status);
                
                const result = await response.json();
                console.log('üì¶ Response data:', result);
                
                if (response.ok) {
                    resultDiv.textContent = '‚úÖ SUCCESS!\n\n' + JSON.stringify(result, null, 2);
                    resultDiv.className = 'success';
                } else {
                    resultDiv.textContent = '‚ùå ERROR!\n\n' + JSON.stringify(result, null, 2);
                    resultDiv.className = 'error';
                }
            } catch (error) {
                console.error('‚ùå Request failed:', error);
                resultDiv.textContent = '‚ùå NETWORK ERROR!\n\n' + error.message + '\n\n' + error.stack;
                resultDiv.className = 'error';
            }
        });
        
        // Load groups on page load
        loadGroups();
    </script>
</body>
</html>
